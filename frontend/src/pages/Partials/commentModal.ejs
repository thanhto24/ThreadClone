<div
  class="modal fade"
  id="commentModal"
  tabindex="-1"
  aria-labelledby="commentModalLabel"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-centered"
    style="
      margin-top: 2rem;
      border-radius: 10px;
      max-width: 768px;
      width: 638px;
    "
  >
    <div
      class="modal-content"
      style="background-color: var(--post); color: var(--white); padding: 0"
    >
      <div class="modal-header" style="border-bottom: none; padding: 10px 20px">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
          style="
            background-color: var(--post);
            border: none;
            color: var(--white);
          "
        >
          Hủy
        </button>
        <span
          class="mx-auto"
          style="font-weight: bold; text-align: center; flex-grow: 1"
          >Thread trả lời</span
        >
      </div>

      <hr style="border-color: var(--white); margin: 0" />

      <div class="modal-body" style="padding: 20px">
        <div class="container_post_comment"></div>

        <form id="create_thread_form_comment">
          <div class="input-section">
            <div class="username">_vteif</div>
            <textarea
              class="input-box"
              placeholder="Trả lời"
              name="content_comment"
            ></textarea>

            <div
              id="image-preview-container-comment"
              style="display: none; position: relative; text-align: center"
            >
              <img id="image-preview-comment" />
              <button
                type="button"
                id="delete-image-comment"
                class="btn btn-danger"
                style="position: absolute; top: 10px; right: 10px; padding: 3px"
              >
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>

            <div class="icon-group">
              <label for="image-upload-comment" class="upload-icon">
                <i class="fa-regular fa-image"></i>
                <input
                  type="file"
                  id="image-upload-comment"
                  style="display: none"
                  aria-label="Upload an image file"
                  name="image_comment"
                />
              </label>
              <button type="button">GIF</button>
              <button type="button" aria-label="Hashtag">
                <i class="fa-solid fa-hashtag"></i>
              </button>
              <button type="button" aria-label="Location">
                <i class="fa-solid fa-location-dot"></i>
              </button>
            </div>
          </div>
        </form>
      </div>
      <div
        class="modal-footer"
        style="
          background-color: var(--post);
          border-top: none;
          display: flex;
          justify-content: space-between;
          padding: 10px 20px;
        "
      >
        <button
          class="reply-settings"
          style="
            background: none;
            border: none;
            color: var(--iconInPost);
            font-size: 0.85rem;
          "
        >
          Bất kỳ ai cũng có thể trả lời và trích dẫn
        </button>
        <button
          class="post-btn"
          id="post-btn-comment"
          type="button"
        >
          Đăng
        </button>
      </div>
    </div>
  </div>

</div>
<script>
  document.addEventListener("focusin", (event) => {
    const modal = document.getElementById("commentModal");
    if (
      modal.getAttribute("aria-hidden") === "true" &&
      modal.contains(event.target)
    ) {
      // Prevent focus inside hidden modal
      event.target.blur();
    }
  });
  
  document.addEventListener("DOMContentLoaded", () => {
    const mediaInput = document.querySelector("#image-upload-comment");
    const previewContainer = document.querySelector("#image-preview-container-comment");
    const textArea = document.querySelector("textarea[name='content_comment']");
    const modal = document.getElementById("commentModal");
  
    mediaInput.addEventListener("change", function (event) {
      const file = event.target.files[0];
  
      if (file) {
        if (file.size > 10 * 1024 * 1024) {
          alert("Dung lượng file phải nhỏ hơn 10 MB.");
          mediaInput.value = "";
          return;
        }
  
        const reader = new FileReader();
        reader.onload = function (e) {
          previewContainer.innerHTML = ""; // Clear previous content
  
          const fileType = file.type.split("/")[0];
  
          if (fileType === "image") {
            const image = document.createElement("img");
            image.src = e.target.result;
            image.style.width = "100%";
            image.style.height = "auto";
            previewContainer.appendChild(image);
          } else if (fileType === "video") {
            const video = document.createElement("video");
            video.src = e.target.result;
            video.controls = true;
            video.style.width = "100%";
            video.style.height = "auto";
            previewContainer.appendChild(video);
          } else {
            alert("Loại file không được hỗ trợ. Vui lòng tải ảnh hoặc video.");
            mediaInput.value = "";
            return;
          }
  
          const deleteButton = document.createElement("button");
          deleteButton.type = "button";
          deleteButton.classList.add("btn", "btn-danger");
          deleteButton.style.position = "absolute";
          deleteButton.style.top = "10px";
          deleteButton.style.right = "10px";
          deleteButton.style.padding = "3px";
          deleteButton.innerHTML = '<i class="fa-solid fa-trash"></i>';
  
          previewContainer.appendChild(deleteButton);
          previewContainer.style.display = "block";
  
          deleteButton.addEventListener("click", function () {
            previewContainer.innerHTML = "";
            previewContainer.style.display = "none";
            mediaInput.value = "";
          });
        };
  
        reader.readAsDataURL(file);
      }
    });
  
    // Clear textarea and image preview when modal is hidden
    modal.addEventListener("hidden.bs.modal", () => {
      textArea.value = ""; // Clear textarea
      previewContainer.innerHTML = ""; // Clear image/video preview
      previewContainer.style.display = "none"; // Hide the container
      mediaInput.value = ""; // Reset the file input
    });
  });
  
</script>
